3.6
1、入职写方案，定计划。安装环境，建立工程  根据要求尽量移植ROS

2、建立目录结果

3、添加CMakeLists.txt 


3.7
1、添加环境 地图文件夹

2、填写读取pgm地图 ok 

3、完善读取PGM ，添加P2的情况

4、添加mapMgr 加载地图loadMap，并将PGM格式转换到mapInfo 自定义数据结构 ok

5、添加costmap costmap2D  测试OK

3.10
1、调整 文件目录结构 重新编译OK

进入build 目录,make install .  cmake ..
软件工程架构
├── 3rd          三方库    json eigen python
├── bin          可执行文件
├── build        编译目录
├── CMakeLists.txt
├── examples     APP交互应用逻辑 
│   └── app
├── lib          不同本地库
├── readme.md
└── src
    ├── comm     通信模块
    ├── common   通用定义
    ├── costmap  代价地图
    ├── loader   文件加载
    ├── localPlan  局部规划
    ├── pathPlanner  全局规划
    └── utils   辅助功能

2、添加layer

3、添加inflation 并测试ok

4、添加footprint  ok

5、t添加辅助计算 中添加点到线的距离  点到点的距离i计算

6、添加 碰撞检查

3.11
1、根据要求，要快速满足需求开发落地，移植ROS NAVIGATION

2、修改命名

3、costmap2d移植ok

3.12
1、修改接口

2、添加layeredCostmap

3、完善costmap2D

3.13
1、inflation test ok

2、加载地图并显示OK

3、膨胀地图显示Ok

4、 修改加载地图接口，将文件名添加到参数

7、地图处理  

2025.3.14
1、添加其他曾  


2025.3.17
1、添加math  point定义

2025.3.18
1、重新整理程序 

2、重新测试footprint  costmap inflation ok

3、添加膨胀检查 ok

4、添加pathPlanner 和 plannerNode  路径规划调度框架

3.20
1、编写全局规划

3.21
1、解决输入start和goal 输入为0问题

2、跑通程序，现在地图发生膨胀，查看原因调整参数

3、添加yaml解析 

4、添加依赖eigen  可以运行，但会发生碰撞

3.22
1、添加碰撞系数 

3.24
1、成功运行出路径，问题点出现在转弯的地方 

2、设置初始方向 


3.25
1、添加运动学模型  

2、添加控制器  

3、添加opencv 显示

4、添加animation 

5、添加 plot绘图 ok

6、用matplot绘制 替代opencv ok

7、修改控制接口，将距离参数作为参数输入

8、添加路径生成后与跟踪控制集成以及仿真 调试有问题TODO:

3.26
1、修复构造函数参数输入bug  之前输入为0

2、添加ctrl+C 控制输入后中断循环

3、路径点的位置还有点问题，会跳变

4、更换地图测试全局规划OK

5、绘图接口增加初始位置接口

6、调整规划接口，放在plannerNode中

7、待调试


3.27
1、运行新的图会卡死在中间一个位置  TODO:

2、修改坐标变换

error: 0.59288
waypoints in x: 710.707
waypoints in y: 344.662
angle: -1.52787
error: -7.12094
waypoints in x: 711.095
waypoints in y: 344.379
Segmentation fault (core dumped) FIXME:


3.28
1、采用matplot显示路径 OK

2、坐标系转换内部抓换世界坐标系 


3.31
1、安装仿真 并测试

2、编辑4轮小车模型

4.1
1、添加仿真 示例ok 

2、自行车模型

4.2
1、添加控制基类 TODO:costmap 接口 待赋值

2、修改地图接口

4.3
1、调试控制器


4.7
1、修改dataDef数据结构 ,添加时间戳和方向定义  

2、添加cmdDef 速度命令数据结构

4.8
1、运行controller+ 仿真 出现问题

2、在gdb模式下运行正常，退出gdb模式，程序出现段错误 
y: 9.18485e-19
yaw: 4.59243e-18
error: 2.78607e-17
Segmentation fault (core dumped)

3、修复controller  bug

4、修复  规划+控制问题
添加索引在有效范围内

4.9
1、调试  控制 仿真小车,速度出现震荡

2、小车坐标系  向前x  为正，向左为y  

3、调整控制接口

4、增加控制设计模式

5、添加仿真 下发(v,w)，并通过差速轮计算线速度和角速度 ok 有一定的偏差

6、在仿真中可以运行，但角速度超上限，待调试TODO:

4.10
1、添加app 应用

2、调试应用，路径显示Ok

3、方向问题待查 

4.11
1、速度问题排查，发现是仿真软件特性最了速度限制

2、后面根据实际小车进行调参TODO:

3、修改控制接口

4.12
1、对路径进行评价

2、版本问题

4.15
1、修改costmap

2、修改参数类型

3、完善APP

4.16
1、调整cmdDef数据结构

2、调整控制率

3、添加坐标变换

4.17
1、调整坐标系，根据仿真软件来定义

测试仿真软件边界
线速度最大不超过0.15

输入v"0.15  反馈 0.147
输入v"-0.15  反馈 -0.147

4.18
1、添加loader 

2、添加json

3、添加config 

4、完善app示例，加载json 车位信息

4.21
1、小车抖动 调试  

2、穿过车位,修改地图

4.22
1、重新修改跟踪算法

4.23
1、调试跟踪算法

4.24
1、修改运动学模型

2、添加插值方法

4.25
1、修复插值问题:角度跳变

2、调试跟着算法

4.27
1、修改代价地图

2、修复代价地图bug

3、转角较小，有场景问题

4.28
1、程序运行崩溃FIXME:

2、调试程序


4.29
1、调试发现显示问题，尝试用python 和opencv 同样会崩溃

2、继续查找原因

4.30
1、发现动态内存问题

3、修改三方库版本

5.6
1、找到崩溃问题点，修复possibly lost (Tcl/Tk)  跟因

2、程序还有潜在问题，继续排查


5.7
1、修复程序崩溃问题
2、代价地图+规划+控制+显示Ok


5.8
1、编写app应用

2、添加接口

5.9
1、调试进程间通信

2、通过server端 按键发送不同的指令到client

5.12
1、添加应用逻辑

2、调整命令

5.13
1、调试应用逻辑 ok

5.14
1、添加反馈命令

2、添加发送控制速度数据,通过消息队列  有奇怪问题风险  数据结构，有些不发送，会发送失败 TODO:

3、修改运动学模型，将加速度改为速度,取消 添加接口

4、添加信号锁

5、修改舵角最大为12度


loader 里的配置 cjson 位置 ok

5.15
1、修改为生成静态库方式，发布的时候只发布可执行文件

2、修改地图位置 放置在bin可执行文件目录下

3、修改车位 json位置 ，放在bin可执行文件目录下

4、测试OK

5.19
1、添加  收到 #106,stop ,1 ，发送到服务端速度为0 ,添加停车状态  OK

2、添加 规划成功后计算行驶时间预测 ok

3

5.20
1、pnc根据产品接收Server端的定位信息，当前速度信息

2、客户端和服务端添加新的线程，用于发送和接收位置信息，当服务端收到客户端反馈的地图状态OK后，开始发送定位信息和小车速度信息 ok

5.23
1、添加激光scan数据 激光+强度

2、修改消息队列缓冲大小

#define BUF_SIZE 4096  
#define MAX_TEXT 4096  原来是128

5.26
1、定义激光数据结构，将收到的激光数据转为x,y等数据

车头方向为x  0度，左边为正  右转为负

2、添加遇到障碍物在一定范围内SAFE_DIS，停车，发送速度和角度为0  ok

5.28
1、添加数据结构超声波数据

2、修改数据结构，添加传感器数据结构

3、修改接口，添加传感器数据设置 

4、接收传感器数据OK

5.29
1、修改地图路径相关程序，客户端接收路径，服务端获取当前路径并发送路径 OK

5.30
1、添加横向转角限幅

2、修改速度输出 控制的纵向输出,从模型计算  限速0.6

3、添加记录传感器数据  超声波数据  对应列

4、修改消息队列Key 从1233--->1235

6.3
1、排查与嵌入式平台消息队列问题

6.4
1、PNC 用的是sizeof
2、发现消息队列的key 有1000--->1235
3、修改消息队列type  PNC发送为偶数2,接收是1
4、修改PNC发送消息队列为1236  接收还是1235
5、修改停车位
6、找到路径的时候才能计算估计时间


规划中将添加世界坐标转为地图坐标系


6.5

json 车位号地图坐标系

添加全局规划   模拟仿真  在厂房图  运动Ok

6.6
1、添加激光处理程序


6.10
1、添加激光雷达处理程序
2、修改控制接口 将初始化的设置规划路径分离出来  增加设置规划路径接口  这样在全局初始化  

6.12
1、小车数据打通，反馈速度 ，下发速度  反馈 线速度 角度

2、输入世界坐标，注意初始位置的地方，方向

3、车位输入的是地图坐标系  ，实际采集的是世界坐标系  在plan中转换为世界坐标系

6.13
1、车位信息json 坐标为地图坐标系  角度为度

2、传感器获取定位信息坐标为世界坐标系  角度为弧度

3、static_cast<double>(msg_data_rec.data.x )/ 1000  转换问题

4、起始角度 

5、仿真坐标变换显示


6、多线程编程

6.14
1、修改bug 

2、修正显示问题

3、接收的是theta  角度 不是yaw

4、速度改小0.5-->0.3


走的时候顿错感

6.16
1、接收线程接受数据改为队列

2、处理数据从队列里取

3、修改坐标系转换  地图和世界坐标  ok

4、添加定位丢失状态

5、可以正常点到点导航  ，修正最后角度调整

6.17
1、修正最后角度调整 调平 TODO  待完善 

2、起始角度大于一定角度  先倒车再前进  ok

3、添加激光停障，恢复  

6.18
1、添加停障计时功能
2、修改膨胀半径

3、到达目标点范围后启动计时

4、到达目标点范围的角度  四项限

6.19
1、调试到达目标点计时

2、去往停车位  角度偏差较大


跑通版本  连续运行 

6.20
1、添加超声波

2、新的test.json 车位停靠点坐标y 

3、超声波数据读取OK

6.23

1、修改 障碍因子指从0.01--->0.9

2、添加超声波处理程序

3、电脑工控机不受控  向日葵接管?

4、膨胀有点小

5、超声波停障OK  


6.24 
1、修改了bug  地图融合的数值问题 

(originMapInfo[j][i] >= 250)//254  融合地图问题

原地图，254  大于255  可通行   127 灰色   0墙
添加激光雷达坐标转换到后轴坐标
激光雷达 距离小车后轴中心1.16


6.25
1、修改小车尺寸及膨胀半径和膨胀系数COST_SCALING_FACTOR,

2、超声波后方检测到障碍物后，改变行驶方向

//上海场站的超声波串口和苏州厂房的接口不同

提速  0.3--->0.5  太低过减速带失败

将激光雷达的偏移位置1.16 后车轴中心改到 小车中间 0.6

6.26
1、速度加到0.6  加速小车，小车异常停止

4.5  2.5  车位大小

2、修改到达目标后，只发送一次,添加标志

3、加入delta 角度平滑

4 、避免反复震荡

7.1
1、整理程序

2、厂房机器故障无法调试

7.2

出现添加一个函数内部变量影响运行结果，诡异问题待查TODO:
1、完善运动学 配置数据结构

2、添加局部规划

3、现场运行出现顿挫  嵌入式软件版本问题
7.3
1、恢复到上海最后版本

2、屏蔽局部规划

7.4
1、添加左右超声波感知到障碍物调整舵角

2、左右避障转弯OK

连续导航速度异常  极小值 解决

7.8
1、取消超声波前方障碍物检测计时，调整发送速度 

2、发现激光雷达数据有固定的噪点

SLAM 判断小车听之后，激光点云停止刷新  ，SLAM模块修复  10s后不刷新    融合定位不计算 ，LaserScan 一直发

7.10
1、添加局部规划

2、移植进pncclient.cpp

3、待调参数，上海图中间会停，局部规划

4、修改规划代价，靠边代价  

5、添加路径平滑，还不够平滑


7.11

1、简化运动学模型

2、优化程序

3、优化局部规划


7.12
1、优化局部规划，考虑遇到障碍物后小车改变运行方向及调整舵角方向


7.14

1、加入超声波障碍物状态的影响



2、机器可以运行MPC局部规划，但比较慢  考虑优化或改方案


7.15
激光雷达正前方为0度，190度FOV  -95～95度


1 、优化激光障碍物检测

2、修改局部规划方案，不是最优。轨迹预测优化 

3、碰撞检测优化

4、并行规划

5、内存优化

候选速度过滤

7.15
现场运行问题:超声波无法检测,硬件异常
超声波停障碍

7.16
注意激光与障碍物距离  激光坐标系  距离小车中心  0.6 

定时器冲突,修复  

7.17
1、反转激光雷达数据:激光雷达 正前方数据  0度，原来是  左边负角度   ，右边 正角度.  要改为: 左边为正，右边为负

yaw  方向角-pi~pi


7.21
1、修改坐标系 

2、调试参数


7.22
1、前面超声波  感知2m 内


小车实际运行可以避障 ,但距离障碍物有些近，需修改参数

7.23

1、添加倒车逻辑 

2、修改避障安全距离

避障距离有点近,待完善

7.25

修正障碍物代价计算

可以跑

7.28
1、去掉局部规划中的障碍物优化处理

2、修正最近距离障碍物计算方法 

3、修改bug  


7.29
1、上海现场运行 ，发现超声波有问题

2、大角度，如果是类似于圆形的路径，大角度跟踪有问题，反复进退

3、由于车位的影响，规划出的路径比较崎岖，待优化

7.30
1、优化规划出来的路径  

2、优化后的路径有问题，导致局部跟踪点不变化，方向相反

3、优化靠边行走

8.1
调试靠边参数, 当前效果较好

调试避障参数  当前可以跟踪，避障再完善

8.4
1、避障可以倒车跟踪到路径

8.5 
1、可以避障，但影响靠边,倒车

2、修改靠边，又无法避障了...


8.6
1、新修改,可以绕障碍，但效果还需继续调参数

8.7
1、修改避障候选点距离

2、超声波前 反了

8.8
1、参数调试

2、调整策略

/////////////////////////////////////////////////////////////////////////////////////////功能原理说明//////////////////////////////////////////////


1--加载地图及加载json文件  解析 车位信息

2--对加载的地图处理为代价地图costmap

3--在代价地图的基础上进行全局规划：包括路径搜索、碰撞检测、代价计算和平滑处理

   全局规划的路径代价偏向与靠边，然后对路径进行平滑

    使用B样条曲线对路径进行平滑处理

4--局部路径跟踪全局路径，同时避障


